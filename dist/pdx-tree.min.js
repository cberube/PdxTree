angular.module("pdxTree",[]),angular.module("pdxTree").service("pdxTreeNestedImplementation",["$compile","pdxTreeDomService","pdxTreeChildManagerService",function($compile,pdxTreeDomService,pdxTreeChildManagerService){var nestedImplementation={name:"nested",removeChildren:function(itemScope){itemScope.containerElement.html("")},addChildren:function(itemScope,childList){angular.forEach(childList,function(childElement){itemScope.containerElement.append(childElement)})},createItem:function(scope,node){var itemElement,containerElement,childContainerTemplate,childContainerElement,itemTemplate=$compile(scope.itemTemplate.clone()),itemScope=scope.$new();return itemElement=itemTemplate(itemScope),childContainerElement=pdxTreeDomService.findChildWithAttribute(itemElement,"pdx-tree-children",!0),childContainerTemplate=$compile(scope.childTemplate.clone()),containerElement=childContainerTemplate(itemScope),angular.element(childContainerElement).replaceWith(containerElement),itemScope.node=node,itemScope.itemTemplate=scope.itemTemplate.clone(),itemScope.pdxTreeNodeDepth=scope.pdxTreeNodeDepth+1,itemScope.childStrategy=nestedImplementation,itemScope.containerElement=containerElement,itemScope.itemElement=itemElement,itemScope.$watch("node.expanded",angular.bind(itemScope,pdxTreeChildManagerService.renderChildren,itemScope)),itemScope.$watch("node.childList",angular.bind(itemScope,pdxTreeChildManagerService.renderChildren,itemScope)),[itemElement]}};return nestedImplementation}]),angular.module("pdxTree").service("pdxTreeSiblingImplementation",["$compile","pdxTreeChildManagerService",function($compile,pdxTreeChildManagerService){var siblingImplementation={name:"sibling",removeChildren:function(itemScope){angular.forEach(itemScope.childElementList,function(childElement){childElement=angular.element(childElement);var childScope=childElement.scope();childScope&&childScope.childStrategy.removeChildren(childScope),childElement.remove()}),itemScope.childElementList=[],itemScope.lastChildElement=itemScope.itemElement},addChildren:function(itemScope,childList){angular.forEach(childList,function(childElement){itemScope.lastChildElement.after(childElement),itemScope.lastChildElement=childElement,itemScope.childElementList.push(childElement)})},createItem:function(scope,node){var itemElement,containerElement,childContainerTemplate,itemTemplate=$compile(scope.itemTemplate.clone()),itemScope=scope.$new(),elementList=[];return itemScope.node=node,itemScope.itemTemplate=scope.itemTemplate.clone(),itemScope.pdxTreeNodeDepth=scope.pdxTreeNodeDepth+1,itemScope.childElementList=[],itemElement=itemTemplate(itemScope),elementList.push(itemElement),childContainerTemplate=$compile(angular.element(itemScope.childTemplate).clone()),containerElement=childContainerTemplate(itemScope),itemScope.containerElement=containerElement,itemScope.itemElement=itemElement,itemScope.lastChildElement=itemElement,itemScope.childStrategy=siblingImplementation,itemScope.$watch("node.expanded",angular.bind(itemScope,pdxTreeChildManagerService.renderChildren,itemScope)),itemScope.$watch("node.childList",angular.bind(itemScope,pdxTreeChildManagerService.renderChildren,itemScope)),elementList}};return siblingImplementation}]),angular.module("pdxTree").service("pdxTreeChildManagerService",[function(){"use strict";var areChildrenLoading=function(itemList){return itemList===!1?!1:"undefined"!=typeof itemList.$resolved?!itemList.$resolved:!angular.isArray(itemList)},hasChildren=function(node){return node&&node.childList&&angular.isArray(node.childList)&&node.childList.length>0},renderChildren=function(itemScope){var childElementList;return itemScope.childStrategy.removeChildren(itemScope),itemScope.node.expanded&&itemScope.node.childList?itemScope.node.childList.$promise&&!itemScope.node.childList.$resolved?(itemScope.node.childList.$promise.then(angular.bind(this,renderChildren,itemScope)),void 0):(angular.forEach(itemScope.node.childList,function(child){childElementList=itemScope.childStrategy.createItem(itemScope,child),itemScope.childStrategy.addChildren(itemScope,childElementList)}),void 0):void 0};return{hasChildren:hasChildren,areChildrenLoading:areChildrenLoading,renderChildren:renderChildren}}]),angular.module("pdxTree").service("pdxTreeDomService",[function(){var destroyChildren=function(parentElement){angular.forEach(parentElement.children(),function(element){var scope;element=angular.element(element),scope=element.scope(),scope&&!scope.$$destroyed&&scope.$destroy(),destroyChildren(element),element.remove()})},appendAllElements=function(parentElement,elementList){angular.forEach(elementList,function(element){parentElement.append(element)})},findChildWithAttribute=function(parent,attribute,recursive){var attributeValue,i,children=parent.children(),childrenSearchResult=null;for(i=0;i<children.length;i++){if(attributeValue=children[i].getAttribute(attribute),"undefined"!=typeof attributeValue&&null!==attributeValue)return children[i];if(recursive&&(childrenSearchResult=findChildWithAttribute(angular.element(children[i]),attribute,!0),null!==childrenSearchResult))return childrenSearchResult}return null};return{appendAllElements:appendAllElements,destroyChildren:destroyChildren,findChildWithAttribute:findChildWithAttribute}}]),angular.module("pdxTree").directive("pdxTree",["$rootScope","$compile","pdxTreeChildManagerService","pdxTreeDomService",function($rootScope,$compile,childManagerService,pdxTreeDomService){var toggleChildren=function(){this.node.expanded=!this.node.expanded,this.node.expanded&&null==this.node.childList&&this.loadChildren(this.node)};return{restrict:"EA",replace:!0,scope:{pdxTreeNodeList:"=",pdxTreeOptions:"="},controller:function($scope){this.setItemTemplate=function(itemTemplateElement){$scope.itemTemplate=itemTemplateElement},this.setChildStrategy=function(strategy){$scope.childStrategy=strategy},this.setChildTemplate=function(childTemplate){$scope.childTemplate=childTemplate}},link:function(scope){var targetElement=scope.itemTemplate.parent();scope.toggleChildren=toggleChildren,scope.loadChildren=scope.pdxTreeOptions.loadChildren||function(){return!1},scope.pdxTreeNodeDepth=0,targetElement.html(""),angular.forEach(scope.pdxTreeNodeList,function(node){pdxTreeDomService.appendAllElements(targetElement,scope.childStrategy.createItem(scope,node))})}}}]),angular.module("pdxTree").directive("pdxTreeItem",[function(){return{restrict:"EA",require:"?^pdxTree",controller:function($scope){this.getElement=function(){return $scope.element}},link:function(scope,element,attributes,pdxTree){scope.element=element,pdxTree&&pdxTree.setItemTemplate(angular.element(element))}}}]),angular.module("pdxTree").directive("pdxTreeChildren",["pdxTreeNestedImplementation","pdxTreeSiblingImplementation",function(pdxTreeNestedImplementation,pdxTreeSiblingImplementation){return{restrict:"EA",require:["?^pdxTree","?^pdxTreeItem"],link:function(scope,element,attributes,treeControllers){var pdxTree=treeControllers[0],pdxTreeItem=treeControllers[1];pdxTree&&pdxTreeItem&&(pdxTree.setChildTemplate(element),pdxTree.setChildStrategy(pdxTreeItem.getElement()===element?pdxTreeSiblingImplementation:pdxTreeNestedImplementation))}}}]);